---
import GitHubIcon from "./icons/GitHubIcon.astro";
import LinkedInIcon from "./icons/LinkedInIcon.astro";

const formEndpoint = import.meta.env.PUBLIC_FORM_ENDPOINT;
---

<section id="contact" class="section bg-white dark:bg-dark-sidebar">
  <!-- Decorative elements -->
  <div class="pointer-events-none absolute inset-0 overflow-hidden">
    <div class="blob left-1/4 top-0 bg-primary-400/10"></div>
    <div class="blob bottom-0 right-1/4 bg-primary-600/10"></div>
  </div>

  <div class="container relative z-10 mx-auto max-w-4xl">
    <div class="mb-12 text-center">
      <h2 class="gradient-text mb-4 text-4xl font-bold">Get In Touch</h2>
      <div
        class="mx-auto mb-8 h-1 w-20 rounded-full bg-gradient-to-r from-primary-600 to-primary-400"
      >
      </div>
      <p class="mx-auto max-w-2xl text-lg text-slate-700 dark:text-dark-text">
        I'm currently open to new opportunities. Whether you have a question or just want to say hi,
        feel free to reach out!
      </p>
    </div>

    <div class="grid items-start gap-12 md:grid-cols-2">
      <!-- Contact Form -->
      <div class="card p-8">
        <form id="contact-form" class="space-y-6" aria-label="Contact form">
          <div>
            <label for="name" class="label">
              Name <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="input"
              placeholder="Your name"
            />
          </div>

          <div>
            <label for="email" class="label">
              Email <span class="text-red-500">*</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="input"
              placeholder="your.email@example.com"
            />
          </div>

          <div>
            <label for="subject" class="label">
              Subject <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="subject"
              name="subject"
              required
              class="input"
              placeholder="What's this about?"
            />
          </div>

          <div>
            <label for="message" class="label">
              Message <span class="text-red-500">*</span>
            </label>
            <textarea
              id="message"
              name="message"
              required
              rows="5"
              class="textarea"
              placeholder="Your message..."></textarea>
          </div>

          <button type="submit" class="btn btn-primary group w-full justify-center">
            <i
              class="ph-duotone ph-paper-plane-tilt text-xl transition-transform group-hover:translate-x-1"
            ></i>
            Send Message
          </button>

          <!-- Status messages -->
          <div id="form-status" class="hidden">
            <div
              id="success-message"
              class="hidden rounded-lg border border-green-200 bg-green-100 p-4 text-green-700 dark:border-green-800 dark:bg-green-900/30 dark:text-green-400"
            >
              <div class="flex items-center gap-2">
                <i class="ph-duotone ph-check-circle text-xl"></i>
                <span>Message sent successfully! I'll get back to you soon.</span>
              </div>
            </div>
            <div
              id="error-message"
              class="hidden rounded-lg border border-red-200 bg-red-100 p-4 text-red-700 dark:border-red-800 dark:bg-red-900/30 dark:text-red-400"
            >
              <div class="flex items-center gap-2">
                <i class="ph-duotone ph-warning-circle text-xl"></i>
                <span>Failed to send message. Please try again or contact me directly.</span>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Contact Info & Social Links -->
      <div class="space-y-6">
        <!-- Social Links -->
        <div class="card p-6">
          <h3
            class="mb-4 flex items-center gap-2 text-lg font-semibold text-slate-900 dark:text-slate-100"
          >
            <i class="ph-duotone ph-link text-xl text-primary-600 dark:text-primary-400"></i>
            Connect With Me
          </h3>
          <div class="space-y-3">
            <a
              href="https://github.com/alinangnaiba"
              target="_blank"
              rel="noopener noreferrer"
              class="group flex items-center gap-3 rounded-lg p-3 transition-colors hover:bg-slate-50 dark:hover:bg-dark-highlight"
              aria-label="Visit GitHub profile"
            >
              <div
                class="flex h-10 w-10 items-center justify-center rounded-lg bg-slate-900 transition-transform group-hover:scale-110 dark:bg-slate-700"
              >
                <GitHubIcon class="h-5 w-5 text-white" />
              </div>
              <div class="flex-1">
                <div
                  class="font-medium text-slate-900 transition-colors group-hover:text-primary-600 dark:text-slate-100 dark:group-hover:text-primary-400"
                >
                  GitHub
                </div>
                <div class="text-sm text-slate-500 dark:text-slate-400">@alinangnaiba</div>
              </div>
              <i
                class="ph ph-arrow-up-right text-slate-400 transition-colors group-hover:text-primary-600 dark:group-hover:text-primary-400"
              ></i>
            </a>

            <a
              href="https://linkedin.com/in/alynamarillo"
              target="_blank"
              rel="noopener noreferrer"
              class="group flex items-center gap-3 rounded-lg p-3 transition-colors hover:bg-slate-50 dark:hover:bg-dark-highlight"
              aria-label="Visit LinkedIn profile"
            >
              <div
                class="flex h-10 w-10 items-center justify-center rounded-lg bg-blue-600 transition-transform group-hover:scale-110"
              >
                <LinkedInIcon class="h-5 w-5 text-white" />
              </div>
              <div class="flex-1">
                <div
                  class="font-medium text-slate-900 transition-colors group-hover:text-primary-600 dark:text-slate-100 dark:group-hover:text-primary-400"
                >
                  LinkedIn
                </div>
                <div class="text-sm text-slate-500 dark:text-slate-400">@alynamarillo</div>
              </div>
              <i
                class="ph ph-arrow-up-right text-slate-400 transition-colors group-hover:text-primary-600 dark:group-hover:text-primary-400"
              ></i>
            </a>
          </div>
        </div>

        <!-- Quick Info -->
        <div class="card p-6">
          <h3
            class="mb-4 flex items-center gap-2 text-lg font-semibold text-slate-900 dark:text-slate-100"
          >
            <i class="ph-duotone ph-info text-xl text-primary-600 dark:text-primary-400"></i>
            Quick Info
          </h3>
          <div class="space-y-3 text-sm">
            <div class="flex items-start gap-3">
              <i class="ph-duotone ph-map-pin mt-0.5 text-lg text-primary-600 dark:text-primary-400"
              ></i>
              <div>
                <div class="font-medium text-slate-900 dark:text-slate-100">Location</div>
                <div class="text-slate-600 dark:text-slate-400">Solihull, UK</div>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <i
                class="ph-duotone ph-briefcase mt-0.5 text-lg text-primary-600 dark:text-primary-400"
              ></i>
              <div>
                <div class="font-medium text-slate-900 dark:text-slate-100">Availability</div>
                <div class="text-slate-600 dark:text-slate-400">Open to opportunities</div>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <i class="ph-duotone ph-clock mt-0.5 text-lg text-primary-600 dark:text-primary-400"
              ></i>
              <div>
                <div class="font-medium text-slate-900 dark:text-slate-100">Response Time</div>
                <div class="text-slate-600 dark:text-slate-400">Usually within 24 hours</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script define:vars={{ formEndpoint }}>
  const FORM_ENDPOINT = formEndpoint;

  const form = document.getElementById("contact-form");
  const formStatus = document.getElementById("form-status");
  const successMessage = document.getElementById("success-message");
  const errorMessage = document.getElementById("error-message");
  const submitButton = form?.querySelector('button[type="submit"]');

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (submitButton) {
      submitButton.disabled = true;
      submitButton.innerHTML = `
        <i class="ph-duotone ph-circle-notch text-xl animate-spin"></i>
        Sending...
      `;
    }

    const formData = new FormData(form);
    const data = {
      name: formData.get("name"),
      email: formData.get("email"),
      subject: formData.get("subject"),
      message: formData.get("message"),
      origin: window.location.origin,
    };

    try {
      if (!FORM_ENDPOINT) {
        throw new Error("Form endpoint not configured. Please follow GOOGLE_APPS_SCRIPT_SETUP.md");
      }

      const response = await fetch(FORM_ENDPOINT, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
        mode: "no-cors",
      });

      formStatus?.classList.remove("hidden");
      successMessage?.classList.remove("hidden");
      errorMessage?.classList.add("hidden");

      form.reset();

      if (submitButton) {
        submitButton.disabled = false;
        submitButton.innerHTML = `
          <i class="ph-duotone ph-paper-plane-tilt text-xl group-hover:translate-x-1 transition-transform"></i>
          Send Message
        `;
      }

      // Hide success message after 7 seconds
      setTimeout(() => {
        successMessage?.classList.add("hidden");
        formStatus?.classList.add("hidden");
      }, 7000);
    } catch (error) {
      console.error("Form submission error:", error);

      formStatus?.classList.remove("hidden");
      errorMessage?.classList.remove("hidden");
      successMessage?.classList.add("hidden");

      if (submitButton) {
        submitButton.disabled = false;
        submitButton.innerHTML = `
          <i class="ph-duotone ph-paper-plane-tilt text-xl group-hover:translate-x-1 transition-transform"></i>
          Send Message
        `;
      }

      // Hide error message after 10 seconds
      setTimeout(() => {
        errorMessage?.classList.add("hidden");
        formStatus?.classList.add("hidden");
      }, 10000);
    }
  });
</script>
