---
import GitHubIcon from './icons/GitHubIcon.astro';
import LinkedInIcon from './icons/LinkedInIcon.astro';

const formEndpoint = import.meta.env.PUBLIC_FORM_ENDPOINT;
---

<section id="contact" class="py-20 px-6 bg-white dark:bg-dark-sidebar relative overflow-hidden">
  <!-- Decorative elements -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-primary-400/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-primary-600/10 rounded-full blur-3xl"></div>
  </div>
  
  <div class="container mx-auto max-w-4xl relative z-10">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold mb-4 gradient-text">
        Get In Touch
      </h2>
      <div class="w-20 h-1 bg-gradient-to-r from-primary-600 to-primary-400 mx-auto mb-8 rounded-full"></div>
      <p class="text-lg text-slate-700 dark:text-dark-text max-w-2xl mx-auto">
        I'm currently open to new opportunities. Whether you have a question or just want to say hi, 
        feel free to reach out!
      </p>
    </div>

    <div class="grid md:grid-cols-2 gap-12 items-start">
      <!-- Contact Form -->
      <div class="card p-8">
        <form id="contact-form" class="space-y-6" aria-label="Contact form">
          <div>
            <label for="name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Name <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="name" 
              name="name" 
              required
              class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-dark-border bg-white dark:bg-dark-bg text-slate-900 dark:text-dark-text focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all outline-none"
              placeholder="Your name"
            />
          </div>

          <div>
            <label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Email <span class="text-red-500">*</span>
            </label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              required
              class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-dark-border bg-white dark:bg-dark-bg text-slate-900 dark:text-dark-text focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all outline-none"
              placeholder="your.email@example.com"
            />
          </div>

          <div>
            <label for="subject" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Subject <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="subject" 
              name="subject" 
              required
              class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-dark-border bg-white dark:bg-dark-bg text-slate-900 dark:text-dark-text focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all outline-none"
              placeholder="What's this about?"
            />
          </div>

          <div>
            <label for="message" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Message <span class="text-red-500">*</span>
            </label>
            <textarea 
              id="message" 
              name="message" 
              required
              rows="5"
              class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-dark-border bg-white dark:bg-dark-bg text-slate-900 dark:text-dark-text focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all outline-none resize-none"
              placeholder="Your message..."
            ></textarea>
          </div>

          <button 
            type="submit" 
            class="btn btn-primary w-full justify-center group"
          >
            <i class="ph-duotone ph-paper-plane-tilt text-xl group-hover:translate-x-1 transition-transform"></i>
            Send Message
          </button>

          <!-- Status messages -->
          <div id="form-status" class="hidden">
            <div id="success-message" class="hidden p-4 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-lg border border-green-200 dark:border-green-800">
              <div class="flex items-center gap-2">
                <i class="ph-duotone ph-check-circle text-xl"></i>
                <span>Message sent successfully! I'll get back to you soon.</span>
              </div>
            </div>
            <div id="error-message" class="hidden p-4 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded-lg border border-red-200 dark:border-red-800">
              <div class="flex items-center gap-2">
                <i class="ph-duotone ph-warning-circle text-xl"></i>
                <span>Failed to send message. Please try again or contact me directly.</span>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Contact Info & Social Links -->
      <div class="space-y-6">
        <!-- Social Links -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4 flex items-center gap-2">
            <i class="ph-duotone ph-link text-primary-600 dark:text-primary-400 text-xl"></i>
            Connect With Me
          </h3>
          <div class="space-y-3">
            <a 
              href="https://github.com/alinangnaiba" 
              target="_blank" 
              rel="noopener noreferrer"
              class="flex items-center gap-3 p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-dark-highlight transition-colors group"
              aria-label="Visit GitHub profile"
            >
              <div class="w-10 h-10 bg-slate-900 dark:bg-slate-700 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                <GitHubIcon class="w-5 h-5 text-white" />
              </div>
              <div class="flex-1">
                <div class="font-medium text-slate-900 dark:text-slate-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">GitHub</div>
                <div class="text-sm text-slate-500 dark:text-slate-400">@alinangnaiba</div>
              </div>
              <i class="ph ph-arrow-up-right text-slate-400 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors"></i>
            </a>

            <a 
              href="https://linkedin.com/in/alynamarillo" 
              target="_blank" 
              rel="noopener noreferrer"
              class="flex items-center gap-3 p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-dark-highlight transition-colors group"
              aria-label="Visit LinkedIn profile"
            >
              <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                <LinkedInIcon class="w-5 h-5 text-white" />
              </div>
              <div class="flex-1">
                <div class="font-medium text-slate-900 dark:text-slate-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">LinkedIn</div>
                <div class="text-sm text-slate-500 dark:text-slate-400">@alynamarillo</div>
              </div>
              <i class="ph ph-arrow-up-right text-slate-400 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors"></i>
            </a>
          </div>
        </div>

        <!-- Quick Info -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4 flex items-center gap-2">
            <i class="ph-duotone ph-info text-primary-600 dark:text-primary-400 text-xl"></i>
            Quick Info
          </h3>
          <div class="space-y-3 text-sm">
            <div class="flex items-start gap-3">
              <i class="ph-duotone ph-map-pin text-primary-600 dark:text-primary-400 text-lg mt-0.5"></i>
              <div>
                <div class="font-medium text-slate-900 dark:text-slate-100">Location</div>
                <div class="text-slate-600 dark:text-slate-400">Solihull, UK</div>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <i class="ph-duotone ph-briefcase text-primary-600 dark:text-primary-400 text-lg mt-0.5"></i>
              <div>
                <div class="font-medium text-slate-900 dark:text-slate-100">Availability</div>
                <div class="text-slate-600 dark:text-slate-400">Open to opportunities</div>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <i class="ph-duotone ph-clock text-primary-600 dark:text-primary-400 text-lg mt-0.5"></i>
              <div>
                <div class="font-medium text-slate-900 dark:text-slate-100">Response Time</div>
                <div class="text-slate-600 dark:text-slate-400">Usually within 24 hours</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script define:vars={{ formEndpoint }}>
  const FORM_ENDPOINT = formEndpoint;
  
  const form = document.getElementById('contact-form');
  const formStatus = document.getElementById('form-status');
  const successMessage = document.getElementById('success-message');
  const errorMessage = document.getElementById('error-message');
  const submitButton = form?.querySelector('button[type="submit"]');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (submitButton) {
      submitButton.disabled = true;
      submitButton.innerHTML = `
        <i class="ph-duotone ph-circle-notch text-xl animate-spin"></i>
        Sending...
      `;
    }
    
    const formData = new FormData(form);
    const data = {
      name: formData.get('name'),
      email: formData.get('email'),
      subject: formData.get('subject'),
      message: formData.get('message'),
      origin: window.location.origin
    };

    try {
      if (!FORM_ENDPOINT) {
        throw new Error('Form endpoint not configured. Please follow GOOGLE_APPS_SCRIPT_SETUP.md');
      }

      const response = await fetch(FORM_ENDPOINT, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
        mode: 'no-cors'
      });
      
      formStatus?.classList.remove('hidden');
      successMessage?.classList.remove('hidden');
      errorMessage?.classList.add('hidden');
      
      form.reset();
      
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.innerHTML = `
          <i class="ph-duotone ph-paper-plane-tilt text-xl group-hover:translate-x-1 transition-transform"></i>
          Send Message
        `;
      }
      
      // Hide success message after 7 seconds
      setTimeout(() => {
        successMessage?.classList.add('hidden');
        formStatus?.classList.add('hidden');
      }, 7000);
      
    } catch (error) {
      console.error('Form submission error:', error);
      
      formStatus?.classList.remove('hidden');
      errorMessage?.classList.remove('hidden');
      successMessage?.classList.add('hidden');
      
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.innerHTML = `
          <i class="ph-duotone ph-paper-plane-tilt text-xl group-hover:translate-x-1 transition-transform"></i>
          Send Message
        `;
      }
      
      // Hide error message after 10 seconds
      setTimeout(() => {
        errorMessage?.classList.add('hidden');
        formStatus?.classList.add('hidden');
      }, 10000);
    }
  });
</script>
